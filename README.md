# Tauri Plugin mobile-sharetarget

## Description

This plugin is an alternative to [tauri-plugin-sharetarget](https://gitlab.com/lafleurdeboum/tauri-plugin-sharetarget).
It is command based rather than event based, making the management of incoming intents more reliable, especially when your webview isn't able to listen to events yet. 

## Installation

This plugin works by linking a Rust function to some native code (Kotlin or Swift).
Thus the plugin needs to load the lib generated by Tauri. The issue is, this lib name changes
with the app name. 
Your Tauri app lib name sits in the `src-tauri/Cargo.toml` file :
```toml
[lib]
...
name = "tauri_app_lib"
...
```

Thus to use this plugin, you need to fork this repo. Here are the steps : 

1. Fork this repo or clone it locally.
2. In this file `android/src/main/java/Sharetarget.kt` at line 10, replace "tauri_app_lib" by your app lib name (see above).
3. Add the packages to your app: 
`Cargo.toml`
```toml
...
[target."cfg(any(target_os = \"android\", target_os = \"ios\"))".dependencies]
# Adapt the path to your needs or use git
tauri-plugin-mobile-sharetarget = { path = "../../tauri-plugin-mobile-sharetarget" }
```
`lib.rs`
```rust
#[cfg(mobile)]
    {
        builder = builder
            .plugin(tauri_plugin_mobile_sharetarget::init());
    }
```
`package.json`
```json
...
// Do not forget to build the package before installing. Adapt the path to your needs or use git
		"tauri-plugin-mobile-sharetarget-api": "file:../../tauri-plugin-mobile-sharetarget"
...
```
4. Add the required intent filters
### Android 
`AndroidManifest.xml`
```xml
<?xml version="1.0" encoding="utf-8">
<manifest ...>
    ...
    <application ...>
        ...
        <activity ...>
            <intent-filter>
                <!-- Support receiving share events. -->
                <action android:name="android.intent.action.SEND" />
                <category android:name="android.intent.category.DEFAULT" />
                <!-- You can scope any MIME type here. You'll see what Intent Android returns. -->
                <data android:mimeType="text/*" />
            </intent-filter>
        </activity ...>
        ...

```
5. Add the required permissions to your capabilities (don't forget to use it in your `tauri.conf.json`).
`src-tauri/capabilities/mobile.json`
```json
{
	"$schema": "../gen/schemas/mobile-schema.json",
	"identifier": "mobile",
	"description": "Capability for the main mobile window",
	"windows": ["main"],
	"permissions": ["mobile-sharetarget:default"],
	"platforms": ["android", "iOS"]
}
```

## Usage

Intents are stored in a Rust queue. Each call to the queue pops the latest intent in the queue.

You can call `getLatestIntent()` to retrieve a raw intent.

You can also call `getLatestIntentAndExtractText()` that extracts the text of a textual share intent.

## Example
An example app is provided in this repo under `examples/tauri-app`.
